import{d as T,u as $,r as c,c as x,b as n,e as G,f as b,g as a,j as B,h as l,o as H,i as _,s as k,k as U,_ as A}from"./index-CXo9aGGs.js";import{s as p}from"./function-call-DiqTgaBZ.js";const N={class:"repo-settings"},j={class:"settings-form"},E={class:"form-footer"},z=T({__name:"RepoSettings",setup(D){const v=$(),{githubConfig:V,updateGithubConfig:w}=B(),m=c(!1),d=c(!1),t=c({...V.value}),C={owner:"仓库所有者的 GitHub 用户名",repo:"仓库的名称，不包含用户名",branch:"要操作的分支名称，通常是 main 或 master",token:"GitHub 个人访问令牌，用于访问和修改仓库"},r=o=>{k({title:"提示",message:C[o],confirmButtonText:"知道了"})},g=async o=>{try{const e=await U({url:`https://api.github.com/repos/${o.owner}/${o.repo}`,method:"GET",headers:{Accept:"application/vnd.github+json",Authorization:o.token?`Bearer ${o.token}`:"","X-GitHub-Api-Version":"2022-11-28"}});return!!(e&&e.id)}catch(e){return console.error("验证配置失败:",e),!1}},h=async()=>{try{m.value=!0;const o=await g(t.value);p({type:o?"success":"fail",message:o?"配置有效":"配置无效，请检查仓库信息和访问令牌"})}catch(o){console.error("测试配置失败:",o),p({type:"fail",message:"测试失败，请检查网络连接"})}finally{m.value=!1}},y=async()=>{console.log("RepoSettings: 开始保存配置:",{owner:t.value.owner,repo:t.value.repo,hasToken:!!t.value.token});try{d.value=!0,console.log("RepoSettings: 开始验证配置");const o=await g(t.value);if(console.log("RepoSettings: 配置验证结果:",o),!o){console.log("RepoSettings: 配置验证失败"),k({title:"验证失败",message:"无法访问指定的仓库，请检查配置是否正确",confirmButtonText:"确定"});return}console.log("RepoSettings: 更新配置"),w(t.value),p({type:"success",message:"配置已保存",onClose:()=>{console.log("RepoSettings: 返回首页"),v.push({name:"home"})}})}catch(o){console.error("RepoSettings: 保存配置失败:",o),p("保存失败")}finally{d.value=!1}};return(o,e)=>{const S=l("van-nav-bar"),i=l("van-icon"),u=l("van-field"),R=l("van-cell-group"),f=l("van-button"),q=l("van-form");return H(),x("div",N,[n(S,{title:"仓库设置","left-arrow":"",onClickLeft:e[0]||(e[0]=s=>G(v).back())}),b("div",j,[n(q,null,{default:a(()=>[n(R,null,{default:a(()=>[n(u,{modelValue:t.value.owner,"onUpdate:modelValue":e[2]||(e[2]=s=>t.value.owner=s),name:"owner",label:"仓库所有者",placeholder:"请输入 GitHub 用户名",rules:[{required:!0,message:"请输入仓库所有者"}]},{"right-icon":a(()=>[n(i,{name:"question-o",onClick:e[1]||(e[1]=s=>r("owner"))})]),_:1},8,["modelValue"]),n(u,{modelValue:t.value.repo,"onUpdate:modelValue":e[4]||(e[4]=s=>t.value.repo=s),name:"repo",label:"仓库名称",placeholder:"请输入仓库名",rules:[{required:!0,message:"请输入仓库名称"}]},{"right-icon":a(()=>[n(i,{name:"question-o",onClick:e[3]||(e[3]=s=>r("repo"))})]),_:1},8,["modelValue"]),n(u,{modelValue:t.value.branch,"onUpdate:modelValue":e[6]||(e[6]=s=>t.value.branch=s),name:"branch",label:"分支",placeholder:"请输入分支名",rules:[{required:!0,message:"请输入分支名"}]},{"right-icon":a(()=>[n(i,{name:"question-o",onClick:e[5]||(e[5]=s=>r("branch"))})]),_:1},8,["modelValue"]),n(u,{modelValue:t.value.token,"onUpdate:modelValue":e[8]||(e[8]=s=>t.value.token=s),name:"token",label:"访问令牌",placeholder:"请输入 GitHub Token",rules:[{required:!0,message:"请输入访问令牌"}]},{"right-icon":a(()=>[n(i,{name:"question-o",onClick:e[7]||(e[7]=s=>r("token"))})]),_:1},8,["modelValue"])]),_:1}),b("div",E,[n(f,{class:"test-btn",type:"default",loading:m.value,onClick:h},{default:a(()=>e[9]||(e[9]=[_(" 测试配置 ")])),_:1},8,["loading"]),n(f,{class:"submit-btn",type:"primary",loading:d.value,onClick:y},{default:a(()=>e[10]||(e[10]=[_(" 保存配置 ")])),_:1},8,["loading"])])]),_:1})])])}}}),X=A(z,[["__scopeId","data-v-2f073a4a"]]);export{X as default};
