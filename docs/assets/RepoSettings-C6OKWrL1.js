import{e as q,i as B,a as G,m as H,r as _,u as U,w as I,g as N,c as n,b as j,s as A,d as M,f as P,h as z,j as E,k as w,l,n as D,o as p,p as L,q as h,t as V,v as X,_ as F}from"./index-gwk1Qvp0.js";const J={icon:"",type:"text",message:"",className:"",overlay:!1,onClose:void 0,onOpened:void 0,duration:2e3,teleport:"body",iconSize:void 0,iconPrefix:void 0,position:"middle",transition:"van-fade",forbidClick:!1,loadingType:void 0,overlayClass:"",overlayStyle:void 0,closeOnClick:!1,closeOnClickOverlay:!1};let g=[],K=!1,S=q({},J);const Q=new Map;function W(a){return G(a)?a:{message:a}}function Y(){const{instance:a,unmount:i}=H({setup(){const r=_(""),{open:k,state:u,close:d,toggle:t}=U(),y=()=>{},c=()=>n(A,j(u,{onClosed:y,"onUpdate:show":t}),null);return I(r,m=>{u.message=m}),N().render=c,{open:k,close:d,message:r}}});return a}function Z(){if(!g.length||K){const a=Y();g.push(a)}return g[g.length-1]}function b(a={}){if(!B)return{};const i=Z(),r=W(a);return i.open(q({},S,Q.get(r.type||S.type),r)),i}const ee={class:"repo-settings"},oe={class:"settings-form"},te={class:"form-footer"},ne=M({__name:"RepoSettings",setup(a){const i=P(),{githubConfig:r,updateGithubConfig:k}=D(),u=_(!1),d=_(!1),t=_({...r.value}),y={owner:"仓库所有者的 GitHub 用户名",repo:"仓库的名称，不包含用户名",branch:"要操作的分支名称，通常是 main 或 master",token:"GitHub 个人访问令牌，用于访问和修改仓库"},c=o=>{V({title:"提示",message:y[o],confirmButtonText:"知道了"})},m=async o=>{try{const e=await X({url:`https://api.github.com/repos/${o.owner}/${o.repo}`,method:"GET",headers:{Accept:"application/vnd.github+json",Authorization:o.token?`Bearer ${o.token}`:"","X-GitHub-Api-Version":"2022-11-28"}});return!!(e&&e.id)}catch(e){return console.error("验证配置失败:",e),!1}},x=async()=>{try{u.value=!0;const o=await m(t.value);b({type:o?"success":"fail",message:o?"配置有效":"配置无效，请检查仓库信息和访问令牌"})}catch(o){console.error("测试配置失败:",o),b({type:"fail",message:"测试失败，请检查网络连接"})}finally{u.value=!1}},O=async()=>{console.log("RepoSettings: 开始保存配置:",{owner:t.value.owner,repo:t.value.repo,hasToken:!!t.value.token});try{d.value=!0,console.log("RepoSettings: 开始验证配置");const o=await m(t.value);if(console.log("RepoSettings: 配置验证结果:",o),!o){console.log("RepoSettings: 配置验证失败"),V({title:"验证失败",message:"无法访问指定的仓库，请检查配置是否正确",confirmButtonText:"确定"});return}console.log("RepoSettings: 更新配置"),k(t.value),b({type:"success",message:"配置已保存",onClose:()=>{console.log("RepoSettings: 返回首页"),i.push({name:"home"})}})}catch(o){console.error("RepoSettings: 保存配置失败:",o),b("保存失败")}finally{d.value=!1}};return(o,e)=>{const R=p("van-nav-bar"),v=p("van-icon"),f=p("van-field"),T=p("van-cell-group"),C=p("van-button"),$=p("van-form");return L(),z("div",ee,[n(R,{title:"仓库设置","left-arrow":"",onClickLeft:e[0]||(e[0]=s=>E(i).back())}),w("div",oe,[n($,null,{default:l(()=>[n(T,null,{default:l(()=>[n(f,{modelValue:t.value.owner,"onUpdate:modelValue":e[2]||(e[2]=s=>t.value.owner=s),name:"owner",label:"仓库所有者",placeholder:"请输入 GitHub 用户名",rules:[{required:!0,message:"请输入仓库所有者"}]},{"right-icon":l(()=>[n(v,{name:"question-o",onClick:e[1]||(e[1]=s=>c("owner"))})]),_:1},8,["modelValue"]),n(f,{modelValue:t.value.repo,"onUpdate:modelValue":e[4]||(e[4]=s=>t.value.repo=s),name:"repo",label:"仓库名称",placeholder:"请输入仓库名",rules:[{required:!0,message:"请输入仓库名称"}]},{"right-icon":l(()=>[n(v,{name:"question-o",onClick:e[3]||(e[3]=s=>c("repo"))})]),_:1},8,["modelValue"]),n(f,{modelValue:t.value.branch,"onUpdate:modelValue":e[6]||(e[6]=s=>t.value.branch=s),name:"branch",label:"分支",placeholder:"请输入分支名",rules:[{required:!0,message:"请输入分支名"}]},{"right-icon":l(()=>[n(v,{name:"question-o",onClick:e[5]||(e[5]=s=>c("branch"))})]),_:1},8,["modelValue"]),n(f,{modelValue:t.value.token,"onUpdate:modelValue":e[8]||(e[8]=s=>t.value.token=s),name:"token",label:"访问令牌",placeholder:"请输入 GitHub Token",rules:[{required:!0,message:"请输入访问令牌"}]},{"right-icon":l(()=>[n(v,{name:"question-o",onClick:e[7]||(e[7]=s=>c("token"))})]),_:1},8,["modelValue"])]),_:1}),w("div",te,[n(C,{class:"test-btn",type:"default",loading:u.value,onClick:x},{default:l(()=>e[9]||(e[9]=[h(" 测试配置 ")])),_:1},8,["loading"]),n(C,{class:"submit-btn",type:"primary",loading:d.value,onClick:O},{default:l(()=>e[10]||(e[10]=[h(" 保存配置 ")])),_:1},8,["loading"])])]),_:1})])])}}}),ae=F(ne,[["__scopeId","data-v-2f073a4a"]]);export{ae as default};
