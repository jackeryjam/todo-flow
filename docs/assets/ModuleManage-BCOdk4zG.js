import{d as V,n as B,u as N,a as I,p as c,r as p,w as $,c as h,b as r,P as q,e as M,o as Y,f as u,g,h as d,t as k,q as L,v as S,x as E,y as P,z as R,s as U,A as m,B as j,_ as z}from"./main-DXefV_px.js";const A={class:"module-list"},F=["onClick"],G={class:"module-content"},J={class:"module-title"},K={class:"module-desc"},O=V({__name:"ModuleManage",setup(Q){const v=B(),C=N(),{docStructure:l}=I(),x=c(()=>Number(v.query.level||1)),f=c(()=>Number(v.query.index||0)),s=c(()=>x.value===1),n=c({get:()=>{var e,t,a;return s.value?((e=l.value)==null?void 0:e.children)||[]:((a=(t=l.value)==null?void 0:t.children[f.value])==null?void 0:a.children)||[]},set:e=>{l.value&&(s.value?l.value.children=e:l.value.children[f.value].children=e)}}),y=e=>{R({title:"确认删除",message:"确定要删除该模块吗？此操作不可恢复",confirmButtonText:"删除",confirmButtonColor:"#ff4444"}).then(()=>{n.value.splice(e,1),U("删除成功")})},D=()=>{const e={title:"新建模块",level:s.value?1:2,type:"branch",metaInfo:{createTime:m().format("YYYY-MM-DD HH:mm:ss"),updateTime:m().format("YYYY-MM-DD HH:mm:ss")},content:"",children:[]};s.value&&(e.children=[{title:"默认子模块",level:2,type:"branch",metaInfo:{createTime:m().format("YYYY-MM-DD HH:mm:ss"),updateTime:m().format("YYYY-MM-DD HH:mm:ss")},content:"",children:[]}]),n.value.unshift(e)},_=p(),i=p(),b=e=>{i.value=e,j(()=>{var t;(t=_.value)==null||t.open()})};return $(()=>i.value,e=>{if(e){const t=n.value.findIndex(a=>a.title===e.title);t!==-1&&(n.value[t]=e)}},{deep:!0}),(e,t)=>{const a=M("van-icon"),H=M("van-nav-bar");return Y(),h(q,null,{nav:r(()=>[u(H,{title:s.value?"一级模块管理":"二级模块管理","left-arrow":"",onClickLeft:t[0]||(t[0]=o=>g(C).back())},{right:r(()=>[u(a,{name:"plus",onClick:D})]),_:1},8,["title"])]),default:r(()=>[d("div",A,[u(g(S),{modelValue:n.value,"onUpdate:modelValue":t[1]||(t[1]=o=>n.value=o),"item-key":"title",handle:".drag-handle",animation:"300"},{item:r(({element:o,index:w})=>[d("div",{class:"module-item",onClick:T=>b(o)},[u(a,{name:"bars",class:"drag-handle"}),d("div",G,[d("div",J,k(o.title),1),d("div",K,k(o.content||""),1)]),u(a,{name:"delete",class:"delete-icon",onClick:L(T=>y(w),["stop"])},null,8,["onClick"])],8,F)]),_:1},8,["modelValue"])]),i.value?(Y(),h(E,{key:0,modelValue:i.value,"onUpdate:modelValue":t[2]||(t[2]=o=>i.value=o),ref_key:"contentEditor",ref:_},null,8,["modelValue"])):P("",!0)]),_:1})}}}),X=z(O,[["__scopeId","data-v-e16cd923"]]);export{X as default};
