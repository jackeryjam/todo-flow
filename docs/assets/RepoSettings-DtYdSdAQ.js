import{d as T,u as $,r as c,c as x,b as s,P as G,j as B,e as l,o as H,f as n,g as U,h as b,i as _,k,s as p,l as A,_ as N}from"./main-C4h6KKcF.js";const j={class:"settings-form"},L={class:"form-footer"},P=T({__name:"RepoSettings",setup(z){const v=$(),{githubConfig:V,updateGithubConfig:w}=B(),d=c(!1),m=c(!1),t=c({...V.value}),C={owner:"仓库所有者的 GitHub 用户名",repo:"仓库的名称，不包含用户名",branch:"要操作的分支名称，通常是 main 或 master",token:"GitHub 个人访问令牌，用于访问和修改仓库"},r=o=>{k({title:"提示",message:C[o],confirmButtonText:"知道了"})},g=async o=>{try{const e=await A({url:`https://api.github.com/repos/${o.owner}/${o.repo}`,method:"GET",headers:{Accept:"application/vnd.github+json",Authorization:o.token?`Bearer ${o.token}`:"","X-GitHub-Api-Version":"2022-11-28"}});return!!(e&&e.id)}catch(e){return console.error("验证配置失败:",e),!1}},y=async()=>{try{d.value=!0;const o=await g(t.value);p({type:o?"success":"fail",message:o?"配置有效":"配置无效，请检查仓库信息和访问令牌"})}catch(o){console.error("测试配置失败:",o),p({type:"fail",message:"测试失败，请检查网络连接"})}finally{d.value=!1}},h=async()=>{console.log("RepoSettings: 开始保存配置:",{owner:t.value.owner,repo:t.value.repo,hasToken:!!t.value.token});try{m.value=!0,console.log("RepoSettings: 开始验证配置");const o=await g(t.value);if(console.log("RepoSettings: 配置验证结果:",o),!o){console.log("RepoSettings: 配置验证失败"),k({title:"验证失���",message:"无法访问指定的仓库，请检查配置是否正确",confirmButtonText:"确定"});return}console.log("RepoSettings: 更新配置"),w(t.value),p({type:"success",message:"配置已保存",onClose:()=>{console.log("RepoSettings: 返回首页"),v.push({name:"home"})}})}catch(o){console.error("RepoSettings: 保存配置失败:",o),p("保存失败")}finally{m.value=!1}};return(o,e)=>{const S=l("van-nav-bar"),i=l("van-icon"),u=l("van-field"),R=l("van-cell-group"),f=l("van-button"),q=l("van-form");return H(),x(G,null,{nav:s(()=>[n(S,{title:"仓库设置","left-arrow":"",onClickLeft:e[0]||(e[0]=a=>U(v).back())})]),default:s(()=>[b("div",j,[n(q,null,{default:s(()=>[n(R,null,{default:s(()=>[n(u,{modelValue:t.value.owner,"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.owner=a),name:"owner",label:"仓库所有者",placeholder:"请输入 GitHub 用户名",rules:[{required:!0,message:"请输入仓库所有者"}]},{"right-icon":s(()=>[n(i,{name:"question-o",onClick:e[1]||(e[1]=a=>r("owner"))})]),_:1},8,["modelValue"]),n(u,{modelValue:t.value.repo,"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.repo=a),name:"repo",label:"仓库名称",placeholder:"请输入仓库名",rules:[{required:!0,message:"请输入仓库名称"}]},{"right-icon":s(()=>[n(i,{name:"question-o",onClick:e[3]||(e[3]=a=>r("repo"))})]),_:1},8,["modelValue"]),n(u,{modelValue:t.value.branch,"onUpdate:modelValue":e[6]||(e[6]=a=>t.value.branch=a),name:"branch",label:"分支",placeholder:"请输入分支名",rules:[{required:!0,message:"请输入分支名"}]},{"right-icon":s(()=>[n(i,{name:"question-o",onClick:e[5]||(e[5]=a=>r("branch"))})]),_:1},8,["modelValue"]),n(u,{modelValue:t.value.token,"onUpdate:modelValue":e[8]||(e[8]=a=>t.value.token=a),name:"token",label:"访问令牌",placeholder:"请输入 GitHub Token",rules:[{required:!0,message:"请输入访问令牌"}]},{"right-icon":s(()=>[n(i,{name:"question-o",onClick:e[7]||(e[7]=a=>r("token"))})]),_:1},8,["modelValue"])]),_:1}),b("div",L,[n(f,{class:"test-btn",type:"default",loading:d.value,onClick:y},{default:s(()=>e[9]||(e[9]=[_(" 测试配置 ")])),_:1},8,["loading"]),n(f,{class:"submit-btn",type:"primary",loading:m.value,onClick:h},{default:s(()=>e[10]||(e[10]=[_(" 保存配置 ")])),_:1},8,["loading"])])]),_:1})])]),_:1})}}}),E=N(P,[["__scopeId","data-v-c55d92d2"]]);export{E as default};
